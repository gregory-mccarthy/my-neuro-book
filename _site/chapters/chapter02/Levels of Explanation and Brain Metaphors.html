<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>levels-of-explanation-and-brain-metaphors – My Neuro Book</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="lecture-2-levels-of-analysis-and-brain-metaphors" class="level1">
<h1><strong>Lecture 2: Levels of Analysis and Brain Metaphors</strong></h1>
<p>Science is built not only from data but also from the scaffolds we use to interpret it. We rely on concepts, metaphors, and levels of description to make the unfamiliar intelligible. For a system as complex as the brain, scaffolds are indispensable. Yet they are also dangerous. What begins as a useful shorthand can harden into dogma. What starts as metaphor can be mistaken for mechanism. In this chapter, we will examine three such scaffolds that have shaped neuroscience: the problem of <strong>levels of analysis</strong>, the perzcsistence of the <strong>computer metaphor</strong>, and the promise of <strong>control theory</strong> as a more biologically grounded framework.</p>
<p>The aim is not to dismiss the past. Each scaffold has illuminated aspects of the brain, sometimes brilliantly. But each has also constrained imagination when taken too literally. The deeper lesson is humility: science progresses by bootstrapping on imperfect tools, climbing scaffolds built by our predecessors, and then replacing them when they no longer serve.</p>
<section id="levels-of-analysis-the-problem-of-category-errors" class="level2">
<h2 class="anchored" data-anchor-id="levels-of-analysis-the-problem-of-category-errors"><strong>Levels of Analysis: The Problem of Category Errors</strong></h2>
<p>One of the central difficulties in cognitive neuroscience is confusing <strong>levels of analysis</strong>. Concepts that are useful at the behavioral level are often reified as if they were literal brain mechanisms. Consider <strong>attention</strong>, <strong>working memory</strong>, or <strong>executive function</strong>. These terms originated in psychology to describe and predict patterns of behavior. They were not discovered by peering into the brain. Yet cognitive neuroscience often treats them as if they must correspond to dedicated neural systems.</p>
<p>This is a <strong>category error</strong>. It is like mistaking the <strong>menu</strong> for the <strong>meal</strong>. The menu is a representation of the food, useful for making choices and communicating with others. But it is not the food itself, and you would go hungry if you tried to eat it. Similarly, behavioral constructs are tools for organizing experience, not the mechanisms that generate it. Confusing the two risks mistaking a description for an explanation.</p>
<p>To be clear, cognitive psychology did not make this mistake. When Alan Baddeley proposed his model of working memory in the 1970s, he was explicit that it was a behavioral theory. The <strong>phonological loop</strong>, <strong>visuospatial sketchpad</strong>, and <strong>central executive</strong> were not intended as anatomical modules. They were abstractions designed to account for phenomena like the two-second rehearsal span or selective interference effects. At this level, the model was enormously successful.</p>
<p>However, problems arose when cognitive neuroscience, armed with neuroimaging, went searching for the <strong>phonological loop in parietal cortex</strong> or the <strong>central executive in prefrontal cortex</strong>. Elegant studies linked activation patterns to cognitive constructs, producing colorful maps of the brain. But the underlying assumption was flawed: that constructs designed for one level of analysis must correspond directly to mechanisms at another.</p>
<p>The field of&nbsp;<strong>cognitive neuropsychology</strong>&nbsp;represented the most careful attempt to bridge levels. At Queen Square and other centers, researchers such as Elizabeth Warrington and Tim Shallice developed the method of&nbsp;<strong>double dissociation</strong>: if lesion A impairs function X but spares Y, while lesion B impairs Y but spares X, then X and Y must involve at least partially distinct neural systems. This logic disciplined the field, generating a detailed map of cognitive architecture. Researchers identified dissociations between recognizing objects versus faces, processing color versus motion, understanding nouns versus verbs—each seeming to validate a cognitive distinction.</p>
<p>But here’s the critical problem: the constructs being carved were behavioral ones. Researchers started with tasks—remembering digits, recognizing faces, reading words—and asked whether brain damage could selectively impair them. They weren’t asking how the brain itself was organized, but whether the brain respected distinctions that psychologists had already drawn. The dissociations were real empirical facts, but interpreting them in terms of cognitive modules assumed that our behavioral taxonomies map onto neural architecture. The brain damage respects some boundary, but it might not be the boundary we think. Even this sophisticated method still began with behavioral categories and sought to validate them in the brain, rather than asking whether those categories reflected the brain’s own organization.</p>
<section id="deeper-dive-understanding-double-dissociations" class="level3">
<h3 class="anchored" data-anchor-id="deeper-dive-understanding-double-dissociations"><strong>Deeper Dive: Understanding Double Dissociations</strong></h3>
<p>To understand the power and limitations of double dissociations, we need to first understand what dissociations are. A&nbsp;<strong>dissociation</strong>&nbsp;occurs when brain damage impairs one cognitive ability while leaving another relatively intact. Imagine a stroke patient who can still understand everything you say but cannot produce coherent speech themselves. They know what they want to say—they can even write it down—but the words come out garbled or not at all. This is a dissociation: language comprehension is preserved while language production is impaired.</p>
<p>Such cases are striking, but they pose an interpretive problem. Perhaps language production isn’t really separate from comprehension—maybe it’s just harder. A damaged brain might fail at hard tasks while managing easy ones, just as a tired student might solve simple arithmetic but fail at calculus. This is where&nbsp;<strong>single dissociations</strong>&nbsp;prove inadequate. If damage to Broca’s area impairs speech production while sparing comprehension, we can’t conclude these are independent systems. Production might simply be more demanding or more vulnerable to any kind of neural insult.</p>
<p>A&nbsp;<strong>double dissociation</strong>&nbsp;solves this problem through complementary cases. If lesion A impairs function X but spares Y, while lesion B impairs Y but spares X, then X and Y must involve at least partially distinct neural systems. Critically, these don’t need to be lesions in the same individual—the comparison is across patients.</p>
<p>One of Elizabeth Warrington’s most influential discoveries involved memory systems. She studied patients with Korsakoff’s syndrome, who showed profound amnesia—they couldn’t form new long-term memories. Give them a list of words, and minutes later they’d have no recollection of seeing it. Yet these same patients showed normal performance when asked to immediately repeat back a string of digits. Their short-term memory seemed intact.</p>
<p>But this was only a single dissociation. The critical evidence came from the complementary pattern: patients with specific left hemisphere lesions who showed the reverse. Patient KF, studied by Warrington and Shallice, could form new long-term memories normally—he could learn new information and recall it days later. But his digit span was devastated, reduced from the normal seven items to just two. He couldn’t hold a phone number in mind long enough to dial it, yet he could learn new facts and remember yesterday’s events.</p>
<p>This double dissociation seemed definitive: short-term memory and long-term memory must be distinct systems. The behavioral categories that psychologists had proposed appeared to have neural reality. The goal was never simply to localize functions in the brain—in fact, some of the most influential double dissociations were performed without precise knowledge of lesion anatomy. The logic was about carving cognitive processes at their joints, establishing which distinctions mattered at the level of behavior.</p>
<p>Yet modern neuroscience suggests a different interpretation. What we call “short-term memory” appears to be sustained neural activity in the same circuits that represent information during perception and action. What we call “long-term memory” involves synaptic changes in these same circuits. There aren’t separate memory stores—there are different states of the same neural tissue. The double dissociation was real, but the interpretation in terms of distinct memory systems was an artifact of starting with behavioral categories. Perhaps what we observed was really a dissociation between left hemisphere language circuits and other systems, not between hypothetical memory stores. The brain’s joints—where it naturally divides into systems—might be in entirely different places than where our psychological theories would cut.</p>
</section>
</section>
<section id="historical-metaphors-from-pneumatics-to-computers" class="level2">
<h2 class="anchored" data-anchor-id="historical-metaphors-from-pneumatics-to-computers"><strong>Historical Metaphors: From Pneumatics to Computers</strong></h2>
<p>If levels of analysis shape the categories we use, <strong>metaphors</strong> shape the stories we tell. Throughout history, neuroscientists have drawn on the technologies of their era to explain the brain. Each metaphor was illuminating in its time, but each eventually constrained thought when mistaken for literal truth.</p>
<p>In antiquity, the dominant technologies were hydraulics and pneumatics. Greeks and Romans, masters of aqueducts and pumps, imagined that <strong>vital spirits</strong> or <strong>pneuma</strong> flowed through hollow nerves like water through pipes. Galen’s physiology pictured the brain as a reservoir that pumped animal spirits into the body, inflating muscles like bladders. Within the framework of hydraulic engineering, this was a powerful and reasonable model.</p>
<p>In the seventeenth century, René Descartes extended the pneumatic metaphor with the mechanical imagination of his age. At the gardens of Versailles he observed hydraulic automata: statues that struck, danced, or sprayed water when hidden valves opened. He imagined nerves as pipes carrying “animal spirits” and the pineal gland as the valve controlled by the soul. Muscles contracted, in his view, just as statues moved when water pressure filled their chambers.</p>
<p>The age of clockwork brought a new metaphor. Elaborate <strong>automata</strong>, powered by springs and gears, captivated audiences. Birds that sang, dolls that played instruments, machines that walked — all demonstrated that intricate motion could arise from mechanism alone. The nervous system seemed, by analogy, to be clockwork: precise, deterministic, composed of interlocking parts.</p>
<p>The industrial revolution added still more metaphors. The <strong>telegraph</strong> suggested the nervous system as a signaling network, with impulses flashing down wires. The <strong>telephone switchboard</strong> reinforced the idea of cortical “centers” connected by fibers, with operators routing messages from one to another. Each metaphor matched the leading technology of its era, and each seemed to reveal the brain’s secrets.</p>
<p>By the mid-twentieth century, the dominant metaphor was the <strong>digital computer</strong>. With the von Neumann architecture as its template, the brain was reimagined as an information processor. <strong>Memory banks</strong> stored information, a <strong>central processor</strong> manipulated it, and <strong>buses</strong> transferred data back and forth. The vocabulary of computation — <strong>encode</strong>, <strong>retrieve</strong>, <strong>buffer</strong>, <strong>bandwidth</strong> — saturated neuroscience. Working memory was likened to RAM, attention to bandwidth, consolidation to storage transfer. The metaphor was immensely productive. But it also misled.</p>
</section>
<section id="why-brains-are-not-von-neumann-machines" class="level2">
<h2 class="anchored" data-anchor-id="why-brains-are-not-von-neumann-machines"><strong>Why Brains Are Not von Neumann Machines</strong></h2>
<p>The problem is not that brains differ from computers in detail, but that they differ in principle. Von Neumann machines separate <strong>memory</strong> from <strong>processing</strong>, rely on a <strong>central processor</strong>, and move data along <strong>buses</strong>. Brains do none of these things.</p>
<p>In the brain, the same synapses that “store” information also transform it. <strong>Memory and processing are inseparable.</strong> Each neuron is simultaneously a memory element and a processor, integrating thousands of inputs and influencing thousands of outputs. There is no global bus shuttling data around. And there is no central executive fetching instructions. The brain’s 86 billion neurons compute in parallel, without a master controller.</p>
<p>This has profound consequences. To “recall” your grandmother’s face is not to fetch a representation from storage and paste it into a workspace. It is to reconstruct a new pattern of activity, shaped by current inputs and prior connectivity. The physical architecture does not implement an algorithm; it is the computation itself.</p>
<p>The most efficient system for solving the equations of fluid flow in a stream is not a computer simulation of those equations but the stream itself. Water flows around rocks, eddies, and banks by virtue of its physical properties; it does not “calculate” the Navier–Stokes equations. Likewise, neural circuits may not implement algorithms in the computational sense but instead exhibit physical dynamics that naturally yield adaptive behavior. As James Gibson argued, perception and action are rooted in resonance with environmental structure, not in symbol manipulation.</p>
<section id="deeper-dive-computer-architectures" class="level3">
<h3 class="anchored" data-anchor-id="deeper-dive-computer-architectures"><strong>Deeper Dive: Computer Architectures</strong></h3>
<p>It is worth noting that von Neumann machines are not limited to their own architecture. Because they are general-purpose, they can <strong>simulate</strong> other computational systems. A digital computer can emulate parallel processors, analog circuits, or even neural networks. But simulation is not the same as implementation. A river simulating fluid dynamics equations on a laptop is not the same as a river flowing downhill.</p>
<p>At the same time, engineers are now building chips that directly emulate non–von Neumann architectures. <strong>Neuromorphic chips</strong> like Intel’s Loihi use circuits that mimic spiking neurons. <strong>Memristive devices</strong> collapse storage and processing into the same physical substrate, just as synapses do. <strong>Analog computers</strong>, once abandoned, are re-emerging for tasks where continuous dynamics matter. These technologies remind us that von Neumann is not destiny — and that brains may be better understood by architectures where computation and memory are inseparable.</p>
</section>
</section>
<section id="networks-dynamics-and-embodiment" class="level2">
<h2 class="anchored" data-anchor-id="networks-dynamics-and-embodiment"><strong>Networks, Dynamics, and Embodiment</strong></h2>
<p>In response to the limitations of the computer metaphor, neuroscience embraced the <strong>network metaphor</strong>: brains as collections of interconnected nodes, with information flowing along directed graphs. This was a step forward. It highlighted distributed processing, connectivity, and emergent dynamics.</p>
<p>But networks can also drift into abstraction. High-dimensional state spaces, manifold trajectories, and attractor dynamics can become detached from embodied reality. The brain is not a free-floating network. It has inputs and outputs, and its purpose is to control a body in a world. As James Gibson argued, perception is about direct engagement with environmental structure, not the construction of inner pictures. Evolution acts on <strong>behavior</strong>, not on representations. The brain is an embodied control system, not a disembodied network.</p>
</section>
<section id="control-theory-toward-a-better-metaphor" class="level2">
<h2 class="anchored" data-anchor-id="control-theory-toward-a-better-metaphor"><strong>Control Theory: Toward a Better Metaphor</strong></h2>
<p>If not a computer, then what? A more satisfying metaphor is that of the brain as a <strong>control system</strong>: a layered, adaptive, real-time regulator of behavior. Control theory provides the mathematics for such systems, but the core ideas are intuitive.</p>
<section id="from-reflex-to-prediction" class="level3">
<h3 class="anchored" data-anchor-id="from-reflex-to-prediction"><strong>From Reflex to Prediction</strong></h3>
<p>The simplest control system is reactive. A <strong>thermostat</strong> turns on the furnace when temperature falls below a set point and off when it rises above. Early nervous systems functioned much like thermostats. The lamprey’s brain, for example, coordinates swimming through rhythmic motor circuits — essentially reactive loops.</p>
<p>But reactive control has limits. Organisms that could anticipate had an advantage. This led to <strong>feedforward control</strong>: using sensory cues to act in advance. A frog leaping at an insect does not wait for feedback; it generates a predictive strike. A mammal running across rough terrain adjusts its gait before stumbling. Feedforward control requires <strong>internal models</strong>: representations of the body and environment that allow prediction.</p>
<p>Humans extend this further. We simulate future states, weigh possible actions, and choose among them. We not only react and predict but deliberate. This progression — reflex, feedforward, internal model, deliberation — mirrors the evolutionary arc of nervous systems.</p>
</section>
<section id="many-variables-one-body" class="level3">
<h3 class="anchored" data-anchor-id="many-variables-one-body"><strong>Many Variables, One Body</strong></h3>
<p>A thermostat regulates one thing: temperature. Organisms regulate many variables at once: hunger, thirst, fatigue, thermoregulation, reproduction, defense, social affiliation. These drives cannot all be satisfied simultaneously. The brain’s challenge is not only regulation but <strong>arbitration</strong>: deciding what to regulate now and at what cost to other goals.</p>
<p>This arbitration emerges from a hierarchical architecture. The hypothalamus and brainstem regulate basic drives. Midbrain and striatal circuits weigh and prioritize. Cortical systems simulate futures, incorporate social context, and bias the balance. Arbitration is not commanded by a central executive but emerges from <strong>competition, neuromodulation, and learning</strong>.</p>
</section>
<section id="concrete-examples-of-arbitration" class="level3">
<h3 class="anchored" data-anchor-id="concrete-examples-of-arbitration"><strong>Concrete Examples of Arbitration</strong></h3>
<p>A bird suppresses feeding to evade a predator. A parent sacrifices sleep to care for offspring. A human forgoes immediate gratification to invest in a long-term goal. Even exploration and play, which seem frivolous, can be understood as <strong>meta-control strategies</strong>: they expand the model space, improving future arbitration.</p>
<p>These examples illustrate that the brain’s essence is not symbol manipulation but dynamic balancing under constraint. Cognition, in this view, is control.</p>
</section>
</section>
<section id="conclusion-bootstrapping-with-better-scaffolds" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-bootstrapping-with-better-scaffolds"><strong>Conclusion: Bootstrapping with Better Scaffolds</strong></h2>
<p>From pneumatics to computers, each metaphor illuminated the brain in its time. None was foolish; each reflected the tools and intuitions of its era. But metaphors can mislead when mistaken for literal truth. The way forward is to treat them as scaffolds: useful for climbing, but to be discarded once higher ground is reached.</p>
<p>Control theory offers a scaffold that is biologically grounded. It emphasizes feedback, prediction, and arbitration. It reframes cognitive constructs as emergent properties of control. And it prepares us to consider, in the next chapter, how brains evolved the architectures that make such control possible.</p>
<p>Science progresses not by revelation but by bootstrapping. We climb on imperfect scaffolds, building new ones as we go. Our task is to keep climbing, with humility and care.</p>
</section>
<section id="glossary-of-key-terms" class="level2">
<h2 class="anchored" data-anchor-id="glossary-of-key-terms"><strong>Glossary of Key Terms</strong></h2>
<p><strong>Levels of analysis</strong> — Distinct perspectives for describing a system, such as behavior, algorithm, and neural implementation.</p>
<p><strong>Category error</strong> — Mistaking a construct at one level of description for a literal mechanism at another.</p>
<p><strong>Single dissociation</strong> — Impairment of one function while another appears intact, often ambiguous.</p>
<p><strong>Double dissociation</strong> — Evidence that two functions are separable, established when each can be impaired independently.</p>
<p><strong>Von Neumann architecture</strong> — The standard design of digital computers, with separation of memory and processing.</p>
<p><strong>Internal model</strong> — A neural mechanism that simulates aspects of the body or environment to guide prediction and control.</p>
<p><strong>Feedforward control</strong> — Regulation based on prediction rather than feedback.</p>
<p><strong>Drive arbitration</strong> — The resolution of conflicts among competing homeostatic or motivational systems.</p>
<p><strong>Emergent property</strong> — A feature that arises from interactions of simpler elements but is not reducible to them.</p>
<p><strong>Embodiment</strong> — The idea that cognition is grounded in the body’s interaction with the environment.</p>
</section>
<section id="suggested-readings" class="level2">
<h2 class="anchored" data-anchor-id="suggested-readings"><strong>Suggested Readings</strong></h2>
<p>Baddeley, A. D. (1986). <em>Working Memory</em>. Oxford University Press.</p>
<p>Marr, D. (1982). <em>Vision</em>. W.H. Freeman.</p>
<p>Gibson, J. J. (1979). <em>The Ecological Approach to Visual Perception</em>. Houghton Mifflin.</p>
<p>Shallice, T. (1988). <em>From Neuropsychology to Mental Structure</em>. Cambridge University Press.</p>
<p>Wiener, N. (1948). <em>Cybernetics: Or Control and Communication in the Animal and the Machine</em>. MIT Press.</p>
<p>Friston, K. (2010). The free-energy principle: a unified brain theory? <em>Nature Reviews Neuroscience, 11</em>(2), 127–138.</p>
<hr>
<p>✅ Word count: ~6,700</p>
<p>⏱️ Estimated reading time: 27–32 minutes</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>